
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>10.0 Serialising and normalising data &#8212; Research Software Engineering with Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.1 Deserialisation" href="10_01_deserialisation.html" />
    <link rel="prev" title="10. Scientific file formats" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/ATI_logo_black_W1024px.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Research Software Engineering with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Research Software Engineering with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Prerequisites
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../course_prerequisites/index.html">
   Installation Instructions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../course_prerequisites/01_git.html">
     Git &amp; GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../course_prerequisites/02_python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../course_prerequisites/03_editor.html">
     Text Editor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../course_prerequisites/04_jupyter.html">
     Course Contents in Jupyter
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course contents
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module01_introduction_to_python/index.html">
   1. Introduction to Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_00_introduction_to_python.html">
     1.0 Introduction to Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_01_variables.html">
     1.1 Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_02_using_functions.html">
     1.2 Using Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_03_types.html">
     1.3 Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_04_containers.html">
     1.4 Containers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_05_dictionaries.html">
     1.5 Dictionaries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_06_data_structures.html">
     1.6 Data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_07_control_and_flow.html">
     1.7 Control and Flow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_08_iteration.html">
     1.8 Iteration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module01_introduction_to_python/01_09_classroom_exercises.html">
     1.9 Classroom Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module02_intermediate_python/index.html">
   2. Intermediate Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_00_comprehensions.html">
     2.0 Comprehensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_01_functions.html">
     2.1 Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_02_using_libraries.html">
     2.2 Using Libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_03_working_with_files.html">
     2.3 Working with files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_04_getting_data_from_the_internet.html">
     2.4 Getting data from the Internet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_05_data_analysis_example.html">
     2.5 Data analysis example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_06_defining_classes.html">
     2.7 Defining your own classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_07_data_analysis_with_classes.html">
     2.7 Data analysis with classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module02_intermediate_python/02_08_classroom_exercises.html">
     2.7 Classroom Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module03_research_data_in_python/index.html">
   3. Research Data in Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_00_scientific_python.html">
     3.0 Scientific Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_01_fields_and_records.html">
     3.1 Field and Record Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_02_structured_data.html">
     3.2 Structured Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_03_plotting_with_matplotlib.html">
     3.3 Plotting with Matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_04_NumPy.html">
     3.4 NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_05_advanced_numpy.html">
     3.5 Advanced NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_06_boids.html">
     3.6 The Boids!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module03_research_data_in_python/03_07_classroom_exercises.html">
     3.7 Classroom Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module04_version_control_with_git/index.html">
   4. Version Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_00_introduction.html">
     4.0 Introduction to version control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_01_solo_work_with_git.html">
     4.1 Solo work with git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_02_fixing_mistakes.html">
     4.2 Fixing mistakes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_03_publishing.html">
     4.3 Publishing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_04_collaboration.html">
     4.4 Collaboration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_05_fork_and_pull.html">
     4.5 Fork and Pull
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_06_git_theory.html">
     4.6 Git Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_07_branches.html">
     4.7 Branches
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_08_advanced_git_concepts.html">
     4.8 Advanced git concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_09_github_pages.html">
     4.9 Publishing from GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_10_rebasing.html">
     4.10 Rebasing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_11_debugging_with_git_bisect.html">
     4.11 Debugging With git bisect
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module04_version_control_with_git/04_12_multiple_remotes.html">
     4.12 Working with multiple remotes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module05_testing_your_code/index.html">
   5. Testing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_00_introduction.html">
     5.0 Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_01_how_to_test.html">
     5.1 How to test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_02_testing_frameworks.html">
     5.2 Testing frameworks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_03_energy_example.html">
     5.3 Classroom exercise: energy calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_04_mocking.html">
     5.4 Mocking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_05_using_a_debugger.html">
     5.5 Using a debugger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_06_continuous_integration.html">
     5.6 Continuous Integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module05_testing_your_code/05_07_diffusion_example.html">
     Recap example: Monte-Carlo
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module06_software_projects/index.html">
   6. Software Projects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_00_libraries.html">
     6.0 Libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_01_installing_packages.html">
     6.1 Installing libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_02_managing_dependencies.html">
     6.2 Managing Dependencies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_03_non_notebook_python.html">
     6.3 Python outside the notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_04_packaging.html">
     6.4 Packaging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_05_documentation.html">
     6.5 Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_06_software_development.html">
     6.6 Software Project Management
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_07_software_licensing.html">
     6.7 Software Licensing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_08_software_issues.html">
     6.8 Managing software issues
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module06_software_projects/06_09_exercise.html">
     6.9 Exercise: Packaging Troll Treasure
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module07_construction_and_design/index.html">
   7. Construction and Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_00_introduction.html">
     7.0 Construction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_01_comments.html">
     7.1 Comments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_02_coding_conventions.html">
     7.2 Coding conventions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_03_linters.html">
     7.3 Linting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_04_refactoring.html">
     7.4 Refactoring
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_05_object_oriented_design.html">
     7.5 Object-Oriented Design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_06_classes.html">
     7.6 Class design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_07_design_patterns.html">
     7.7 Design Patterns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module07_construction_and_design/07_08_refactoring_boids.html">
     7.8 Exercise: Refactoring The Bad Boids
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module08_advanced_programming_techniques/index.html">
   8. Advanced Programming Techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_00_introduction.html">
     8.0 Advanced Python Programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_01_functional_programming.html">
     8.1 Functional programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_02_iterators_and_generators.html">
     8.2 Iterators and Generators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_03_exceptions.html">
     8.3 Exceptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_04_operator_overloading.html">
     8.4 Operator overloading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_05_metaprogramming.html">
     8.5 Metaprogramming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module08_advanced_programming_techniques/08_06_advanced_operator_overloading.html">
     8.6 Advanced operator overloading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module09_programming_for_speed/index.html">
   9. Programming for Speed
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_00_performance_programming.html">
     9.0 Performance programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_01_optimising_mandelbrot.html">
     9.1 Optimising Mandelbrot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_02_optimising_with_numpy.html">
     9.2 Optimising with NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_03_optimising_with_cython.html">
     9.3 Optimising with Cython
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_04_optimising_with_numba.html">
     9.5 Optimising with Numba
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module09_programming_for_speed/09_05_performance_scaling.html">
     9.5 Performance scaling for containers and algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   10. Scientific file formats
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     10.0 Serialising and normalising data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_01_deserialisation.html">
     10.1 Deserialisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_02_binary_formats.html">
     10.2 Binary formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_03_markup_languages.html">
     10.3 Markup Languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_04_beyond_pandas.html">
     10.04 Larger datasets - beyond pandas and csv
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_05_processing_in_parallel.html">
     10.5 Processing in parallel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_06_geospatial_data.html">
     10.6 Geospatial data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_x0_optional_domain_specific_languages.html">
     10.x.0 (OPTIONAL):  Domain specific languages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_x1_optional_controlled_vocabularies.html">
     10.x.1 (OPTIONAL): Controlled Vocabularies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_x2_optional_semantic_models.html">
     10.x.2 (OPTIONAL):  Semantic file formats
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Solutions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../solutions/index.html">
   Exercise Solutions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_01.html">
     Module 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_02.html">
     Module 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_03.html">
     Module 03
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_04.html">
     Module 04
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_05.html">
     Module 05
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_06.html">
     Module 06: Troll Treasure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_07.html">
     Module 07: Bad Boids
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_08.html">
     Module 08
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_09.html">
     Module 09
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../solutions/module_10.html">
     Module 10
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            <p>Download notes as <a href="/rse-course/pdf/book.pdf">PDF</a>.</p>
<p>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>.</p>

            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/alan-turing-institute/rse-course/main?urlpath=tree/module10_scientific_file_formats/10_00_serialisation_and_normalisation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/alan-turing-institute/rse-course"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/alan-turing-institute/rse-course/issues/new?title=Issue%20on%20page%20%2Fmodule10_scientific_file_formats/10_00_serialisation_and_normalisation.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/alan-turing-institute/rse-course/edit/main/module10_scientific_file_formats/10_00_serialisation_and_normalisation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/module10_scientific_file_formats/10_00_serialisation_and_normalisation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-normal-data-representations-first-normal-form">
   Non-normal data representations: First normal form.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalising-the-reaction-model-a-bad-first-attempt">
   Normalising the reaction model - a bad first attempt.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalising-the-model-relations-and-keys">
   Normalising the model - relations and keys
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-a-database-sqlite">
   Making a database - SQLite
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-objects-the-object-relational-mapping">
   Data and Objects - the Object-Relational-Mapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moving-on-from-databases">
   Moving on from databases
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>10.0 Serialising and normalising data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-normal-data-representations-first-normal-form">
   Non-normal data representations: First normal form.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalising-the-reaction-model-a-bad-first-attempt">
   Normalising the reaction model - a bad first attempt.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalising-the-model-relations-and-keys">
   Normalising the model - relations and keys
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-a-database-sqlite">
   Making a database - SQLite
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-objects-the-object-relational-mapping">
   Data and Objects - the Object-Relational-Mapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moving-on-from-databases">
   Moving on from databases
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="serialising-and-normalising-data">
<h1>10.0 Serialising and normalising data<a class="headerlink" href="#serialising-and-normalising-data" title="Permalink to this headline">#</a></h1>
<p><em>Estimated time for this notebook: 20 minutes</em></p>
<p>Consider a simple python computational model of chemical reaction networks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Element</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Molecule</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Map from element to number of that element in the molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>

    <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">number</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">as_subscript</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;_{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">+</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">as_subscript</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Reaction</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Map from reactants to stoichiometries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">products</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Map from products to stoichiometries</span>

    <span class="k">def</span> <span class="nf">add_reactant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reactant</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span><span class="p">[</span><span class="n">reactant</span><span class="p">]</span> <span class="o">=</span> <span class="n">stoichiometry</span>

    <span class="k">def</span> <span class="nf">add_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">stoichiometry</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">stoichiometry</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_if_not_one</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">side_as_string</span><span class="p">(</span><span class="n">side</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">Reaction</span><span class="o">.</span><span class="n">print_if_not_one</span><span class="p">(</span><span class="n">side</span><span class="p">[</span><span class="n">molecule</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">side</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">Reaction</span><span class="o">.</span><span class="n">side_as_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\\</span><span class="s2">rightarrow &quot;</span>
            <span class="o">+</span> <span class="n">Reaction</span><span class="o">.</span><span class="n">side_as_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">System</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_reaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reaction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">co2</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="mf">44.01</span><span class="p">)</span>
<span class="n">co2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">co2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">h2o</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="mf">18.01</span><span class="p">)</span>
<span class="n">h2o</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">h2o</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">o2</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="mf">32.00</span><span class="p">)</span>
<span class="n">o2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">glucose</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="mf">180.16</span><span class="p">)</span>
<span class="n">glucose</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">glucose</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">glucose</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">combustion</span> <span class="o">=</span> <span class="n">Reaction</span><span class="p">()</span>
<span class="n">combustion</span><span class="o">.</span><span class="n">add_reactant</span><span class="p">(</span><span class="n">glucose</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">combustion</span><span class="o">.</span><span class="n">add_reactant</span><span class="p">(</span><span class="n">o2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">combustion</span><span class="o">.</span><span class="n">add_product</span><span class="p">(</span><span class="n">co2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">combustion</span><span class="o">.</span><span class="n">add_product</span><span class="p">(</span><span class="n">h2o</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">combustion</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C_6H_{12}O_6 + 6O_2 \rightarrow 6CO_2 + 6H_2O
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Math</span><span class="p">,</span> <span class="n">display</span>

<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">combustion</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle C_6H_{12}O_6 + 6O_2 \rightarrow 6CO_2 + 6H_2O\]</div>
</div>
</div>
<p>We could reasonably consider using the LaTeX representation of this as a fileformat for reactions. (Though we need to represent the molecular mass in some way weve not thought of.)</p>
<p>Weve already shown how to <strong>serialise</strong> the data to this representation.
How hard would it be to <strong>deserialise</strong> it?</p>
<p>Actually, pretty darn hard.</p>
<p>In the wild, such datafiles will have all kinds of complications, and making a hand-coded string parser for such
text will be highly problematic. In this lecture, were going to look at the kind of problems that can arise, and
some standard ways to solve them, which will lead us to the idea of <strong>normalisation</strong> in databases.</p>
<p>Next lecture, well look at how we might create a file format which does indeed look like such a fluent mathematical
representation, which well call a <strong>Domain Specific Language</strong>.</p>
<section id="non-normal-data-representations-first-normal-form">
<h2>Non-normal data representations: First normal form.<a class="headerlink" href="#non-normal-data-representations-first-normal-form" title="Permalink to this headline">#</a></h2>
<p>Consider the mistakes that someone might make when typing in a reaction in the above format: they could easily, if there are multiple reactions in a system, type glucose in correctly as <code class="docutils literal notranslate"><span class="pre">C_6H_{12}O_6</span></code> the first time, but the second type accidentally type <code class="docutils literal notranslate"><span class="pre">C_6H_{12}o_6.</span></code></p>
<p>The system wouldnt know these are the same molecule, so, for example, if building a mass action model of reaction kinetics, the differential equations would come out wrong.</p>
<p>The natural-seeming solution to this is, in your data format, to name each molecule and atom, and consider a representation in terms of CSV files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> molecules.csv
<span class="c1"># name, elements, numbers</span>

<span class="n">water</span><span class="p">,</span> <span class="n">H</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="n">oxygen</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">carbon_dioxide</span><span class="p">,</span> <span class="n">C</span> <span class="n">O</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">glucose</span><span class="p">,</span> <span class="n">C</span> <span class="n">H</span> <span class="n">O</span><span class="p">,</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting molecules.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> reactions.csv

<span class="c1"># name, reactants, products, reactant_stoichiometries, product_stoichiometries</span>

<span class="n">combustion_of_glucose</span><span class="p">,</span> <span class="n">glucose</span> <span class="n">oxygen</span><span class="p">,</span> <span class="n">carbon_dioxide</span> <span class="n">water</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting reactions.csv
</pre></div>
</div>
</div>
</div>
<p>Writing a parser for these files would be very similar to the earthquake problem that youve already encountered.</p>
<p>However, the existence of multiple values in one column indicates that this file format is NOT <strong>first normal form</strong> (1NF).</p>
<p><strong>Note:</strong> <em>A table is in first normal form if: every column is unique; no rows are duplicated; each column/row intersection contains only one value.</em></p>
<p>It is not uncommon to encounter file-formats that violate 1NF in the wild. The main problem with them is that you will eventually have to deal with the separation character that you picked (<code class="docutils literal notranslate"><span class="pre">;</span></code> in this case) turning up in someones content and youll need to work out how to escape it.</p>
<p>The art of designing serialisations which work as row-and-column value tables for more complex data structures is the core of database design.</p>
</section>
<section id="normalising-the-reaction-model-a-bad-first-attempt">
<h2>Normalising the reaction model - a bad first attempt.<a class="headerlink" href="#normalising-the-reaction-model-a-bad-first-attempt" title="Permalink to this headline">#</a></h2>
<p>How could we go about normalising this model. One choice is to list each molecule-element <strong>relation</strong> as a separate table row:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> molecules.csv
<span class="c1"># name, element, number</span>

<span class="n">water</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">water</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">oxygen</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">carbon_dioxide</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">carbon_dioxide</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting molecules.csv
</pre></div>
</div>
</div>
</div>
<p>This is fine as far as it goes, but, it falls down as soon as we want to associate another property with a molecule and atom.</p>
<p>We could repeat the data each time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> molecules.csv
<span class="c1"># name, element, number, molecular_mass, atomic_number</span>

<span class="n">water</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">18.01</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">water</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">18.01</span><span class="p">,</span> <span class="mi">8</span>
<span class="n">oxygen</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">32.00</span><span class="p">,</span> <span class="mi">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting molecules.csv
</pre></div>
</div>
</div>
</div>
<p>The existence of the same piece of information in multiple locations (eg. the <code class="docutils literal notranslate"><span class="pre">18.01</span></code> molecular mass of water) indicates that this file format is NOT <strong>second normal form</strong> (2NF).</p>
<p>Furthermore, this would allow our data file to be potentially be self-inconsistent, violating the design principle that each piece of information should be stated only once. A data structure of this type is said to be NOT <strong>second normal form</strong>.</p>
<p><strong>Note:</strong> <em>A table is in second normal form if: it is in first normal form; none of its attributes depend on any other attribute except the primary key.</em></p>
</section>
<section id="normalising-the-model-relations-and-keys">
<h2>Normalising the model - relations and keys<a class="headerlink" href="#normalising-the-model-relations-and-keys" title="Permalink to this headline">#</a></h2>
<p>So, how do we do this correctly?</p>
<p>We need to specify data about each molecule, reaction and atom once, and then specify the <strong>relations</strong> between them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> molecules.csv
<span class="c1"># name, molecular_mass</span>

<span class="n">water</span><span class="p">,</span> <span class="mf">18.01</span>
<span class="n">oxygen</span><span class="p">,</span> <span class="mf">32.00</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting molecules.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> atoms.csv

<span class="c1"># symbol, atomic number</span>
<span class="n">H</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">O</span><span class="p">,</span> <span class="mi">8</span>
<span class="n">C</span><span class="p">,</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting atoms.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> atoms_in_molecules.csv

<span class="c1"># rel_number, molecule, symbol, number</span>
<span class="mi">0</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">1</span>
<span class="mi">2</span><span class="p">,</span> <span class="n">oxygen</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting atoms_in_molecules.csv
</pre></div>
</div>
</div>
</div>
<p>This last table is called a <strong>join table</strong> - and is needed whenever we want to specify a many-to-many relationship.
(Each atom can be in more than one molecule, and each molecule has more than one atom.)</p>
<p>Note each table needs to have a set of columns which taken together form a unique identifier for that row; called a key. If more than one is possible, we choose one and call it a <strong>primary key</strong>. (And in practice, we normally choose a single column for this: hence the rel_number column, though the tuple {molecule, symbol} here is another <strong>candidate key</strong>.)</p>
<p>Now, proper database tools use much more sophisticated representations than just csv files -
including <strong>indices</strong> to enable hash-table like efficient lookups, and support for managing multiple users at the same time.</p>
<p>Furthermore, the <strong>principles</strong> of database normalisation and the relational model will be helpful
right across our thinking about data representation, whether these are dataframes in Pandas, tensors in tensorflow, or anything else</p>
</section>
<section id="making-a-database-sqlite">
<h2>Making a database - SQLite<a class="headerlink" href="#making-a-database-sqlite" title="Permalink to this headline">#</a></h2>
<p>Lets look at how we would use a simple database in Python to represent atoms and molecules. If youve never seen SQL before, you might want to attend an introductory course, such as one of the Software Carpentry sessions. Here were going to assume some existing knowledge but we will use a Python-style way to interact with databases instead of relying on raw SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;molecules.db&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing database to start again from scratch&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No DB since this notebook was last run&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Removing database to start again from scratch
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///molecules.db&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>SQLite is a simple very-lightweight database tool - without support for concurrent users - but its great for little hacks like this. For full-on database work youll probably want to use a more fully-featured database like <a class="reference external" href="https://www.postgresql.org">https://www.postgresql.org</a>.</p>
<p>The metadata for the database describing the tables present, and their columns, is defined in Python using SQLAlchemy, the leading python database tool, thus:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Table</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">molecules</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;molecules&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="n">Float</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;atoms&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;symbol&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">Integer</span>

<span class="n">atoms_in_molecules</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;atoms_molecules&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;atom&quot;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;atoms.symbol&quot;</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;molecule&quot;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;molecules.name&quot;</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,116 INFO sqlalchemy.engine.Engine BEGIN (implicit)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,117 INFO sqlalchemy.engine.Engine PRAGMA main.table_info(&quot;molecules&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,117 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,118 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info(&quot;molecules&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,118 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,119 INFO sqlalchemy.engine.Engine PRAGMA main.table_info(&quot;atoms&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,120 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,120 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info(&quot;atoms&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,121 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,121 INFO sqlalchemy.engine.Engine PRAGMA main.table_info(&quot;atoms_molecules&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,122 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,123 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info(&quot;atoms_molecules&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,126 INFO sqlalchemy.engine.Engine [raw sql] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,127 INFO sqlalchemy.engine.Engine 
CREATE TABLE molecules (
	name VARCHAR NOT NULL, 
	mass FLOAT, 
	PRIMARY KEY (name)
)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,128 INFO sqlalchemy.engine.Engine [no key 0.00061s] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,133 INFO sqlalchemy.engine.Engine 
CREATE TABLE atoms (
	symbol VARCHAR NOT NULL, 
	number INTEGER, 
	PRIMARY KEY (symbol)
)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,133 INFO sqlalchemy.engine.Engine [no key 0.00071s] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,136 INFO sqlalchemy.engine.Engine 
CREATE TABLE atoms_molecules (
	atom VARCHAR, 
	molecule VARCHAR, 
	number INTEGER, 
	FOREIGN KEY(atom) REFERENCES atoms (symbol), 
	FOREIGN KEY(molecule) REFERENCES molecules (name)
)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,137 INFO sqlalchemy.engine.Engine [no key 0.00069s] ()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-11-11 12:16:58,139 INFO sqlalchemy.engine.Engine COMMIT
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MetaData()
</pre></div>
</div>
</div>
</div>
<p>Note the SQL syntax for creating tables is generated by the python tool, and sent to the database server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">molecules</span> <span class="p">(</span>
	<span class="n">name</span> <span class="n">VARCHAR</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span> 
	<span class="n">mass</span> <span class="n">FLOAT</span><span class="p">,</span> 
	<span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Well turn off our automatic printing of all the raw sql to avoid this notebook being unreadable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">echo</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<p>We can also write data to our database using this python tooling:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ins</span> <span class="o">=</span> <span class="n">molecules</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="s2">&quot;18.01&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlalchemy.engine.cursor.LegacyCursorResult at 0x7f490a421640&gt;
</pre></div>
</div>
</div>
</div>
<p>And query it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">select</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">molecules</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="s2">&quot;mass&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18.01
</pre></div>
</div>
</div>
</div>
<p>If we have enough understanding of SQL syntax, we can use appropriate <strong>join</strong> statements to find, for example, the mass of all molecules which contain oxygen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">molecules</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;oxygen&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="s2">&quot;32.00&quot;</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">atoms_in_molecules</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">atoms_in_molecules</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="s2">&quot;oxygen&quot;</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">atoms_in_molecules</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlalchemy.engine.cursor.LegacyCursorResult at 0x7f490a3f9be0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SELECT mass</span>
<span class="sd">    FROM   molecules</span>
<span class="sd">          JOIN atoms_molecules</span>
<span class="sd">            ON molecules.NAME = atoms_molecules.molecule</span>
<span class="sd">          JOIN atoms</span>
<span class="sd">            ON atoms.symbol = atoms_molecules.atom</span>
<span class="sd">    WHERE  atoms.symbol = &#39;H&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(18.01,)]
</pre></div>
</div>
</div>
</div>
<p>But we can do much better</p>
</section>
<section id="data-and-objects-the-object-relational-mapping">
<h2>Data and Objects - the Object-Relational-Mapping<a class="headerlink" href="#data-and-objects-the-object-relational-mapping" title="Permalink to this headline">#</a></h2>
<p>We notice that when we find a correct relational model for our data, many of the rows are suggestive of exactly the data
we would expect to supply to an object constructor - data about an object. References to keys of other tables in rows suggest composition
relations while many-to-many join tables often represent aggregation relationships, and data about the relationship.</p>
<p>As a result of this, powerful tools exist to <strong>automatically</strong> create object structures from database schema, including saving and loading.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;molecules.db&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing database to start again from scratch&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No DB since this notebook was last run&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Removing database to start again from scratch
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///molecules.db&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;atoms&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">molecules</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;AtomsPerMolecule&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;atom&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Molecule</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;molecules&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;AtomsPerMolecule&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;molecule&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AtomsPerMolecule</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;atoms_per_molecule&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">atom_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;atoms.symbol&quot;</span><span class="p">))</span>
    <span class="n">molecule_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;molecules.name&quot;</span><span class="p">))</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we now create our tables, the system will automatically create a DB:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">echo</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<p>And we can create objects with a simple interface that looks just like ordinary classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oxygen</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">hydrogen</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">oxygen</span><span class="p">,</span> <span class="n">hydrogen</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">18.01</span><span class="p">)</span>
<span class="n">oxygen_m</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;oxygen&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">16.00</span><span class="p">)</span>
<span class="n">hydrogen_m</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hydrogen&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">2.02</span><span class="p">)</span>
<span class="n">molecules</span> <span class="o">=</span> <span class="p">[</span><span class="n">water</span><span class="p">,</span> <span class="n">oxygen_m</span><span class="p">,</span> <span class="n">hydrogen_m</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that we are using the `backref` name to construct the `atom_id` and `molecule_id`.</span>
<span class="c1"># These lookup instances of Element and Molecule that are already in our database</span>
<span class="n">amounts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AtomsPerMolecule</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">oxygen</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">water</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">AtomsPerMolecule</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">hydrogen</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">water</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">AtomsPerMolecule</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">oxygen</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">oxygen_m</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">AtomsPerMolecule</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="n">hydrogen</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">hydrogen_m</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">bulk_save_objects</span><span class="p">(</span><span class="n">elements</span> <span class="o">+</span> <span class="n">molecules</span> <span class="o">+</span> <span class="n">amounts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oxygen</span><span class="o">.</span><span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;water&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Molecule</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;water&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This is a very powerful technique - we get our class-type interface in python, with database persistence and searchability for free!</p>
</section>
<section id="moving-on-from-databases">
<h2>Moving on from databases<a class="headerlink" href="#moving-on-from-databases" title="Permalink to this headline">#</a></h2>
<p>Databases are often a good choice for storing data, but can only be interacted with programmatically. Often, we want to make a file format to represent our dataset which can be easily replicated or shared. The next part of this module focuses on the design of such file-formats, both binary and <strong>human-readable</strong>.</p>
<p>One choice, now we know about it, is to serialise all the database tables as CSV:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Molecule</span><span class="p">)</span><span class="o">.</span><span class="n">statement</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;SELECT molecules.name, molecules.mass \nFROM molecules&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Molecule</span><span class="p">)</span><span class="o">.</span><span class="n">statement</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">bind</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>mass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>water</td>
      <td>18.01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>oxygen</td>
      <td>16.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>hydrogen</td>
      <td>2.02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>,name,mass
0,water,18.01
1,oxygen,16.0
2,hydrogen,2.02
</pre></div>
</div>
</div>
</div>
<p>Deserialising is also easy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> atoms.csv

<span class="n">symbol</span><span class="p">,</span><span class="n">number</span>
<span class="n">C</span><span class="p">,</span><span class="mi">6</span>
<span class="n">N</span><span class="p">,</span><span class="mi">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting atoms.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;atoms.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_csv</span><span class="p">:</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f_csv</span><span class="p">)</span>
<span class="n">atoms</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>symbol</th>
      <th>number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>C</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;atoms&quot;</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">bind</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Element</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">number</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7
</pre></div>
</div>
</div>
</div>
<p>However, we know from last time that another common choice is to represent
such complicated data structures in YAML. The implications of what weve just learned for serialising to and from such
structured data is the topic of the next lecture.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./module10_scientific_file_formats"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">10. Scientific file formats</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="10_01_deserialisation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">10.1 Deserialisation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By various <a href="https://github.com/alan-turing-institute/rse-course/graphs/contributors">contributors</a>.
Developed at <a href="https://turing.ac.uk">The Alan Turing Institute</a> based on the <a href="https://github.com/UCL/rsd-engineeringcourse">UCL RSD course</a>.
<br/>
  
    <div class="extra_footer">
      <p>Creative Commons Attribution 2.0 Generic (<a href="https://creativecommons.org/licenses/by/2.0/">CC BY 2.0</a>).</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>